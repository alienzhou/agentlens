# Architecture Decision Records (ADR)

**Document Version**: v1.0  
**Created Date**: 2026-01-04  
**Last Updated**: 2026-01-04

---

## Overview

This document records key architectural decisions in the Vibe Review project. Each decision includes background, decision content, alternatives, decision rationale, and impact analysis.

---

## ADR-001: Agent Review Protocol Design

### Status
✅ **Decided** (2026-01-04)

### Context
In the Vibe Coding era, Agent-generated code lacks "author intent" transmission, causing Review to become "reverse engineering." We need a protocol for Agents to provide structured explanations when generating code.

### Decision Content
Adopt **4-layer protocol structure**:
- **WHAT layer**: Intent (intent), Changes (changes)
- **WHY layer**: Rationale (rationale)
- **HOW TO VERIFY layer**: Tests (tests), Edge Cases (edge cases)
- **IMPACT layer**: Impact (impact analysis)

### Alternatives
1. **3-layer structure**: WHAT/WHY/HOW TO VERIFY (without IMPACT)
2. **5-layer structure**: Add META layer as required field
3. **Free format**: No enforced structure, Agents freely express

### Decision Rationale
1. **IMPACT as independent layer**: Impact analysis is important enough to deserve separate attention, especially in complex systems
2. **Structured design**: Ensures completeness and consistency of information transmission
3. **Balanced complexity**: 4-layer structure balances completeness and usability

### Impact
- **Positive Impact**:
  - Provides complete code understanding framework
  - Standardizes Agent output format
  - Facilitates tool parsing and display
- **Negative Impact**:
  - Increases complexity of Agent-generated content
  - Requires Agents to have impact analysis capabilities

### Related Decisions
- Related to ADR-002 (Data Acquisition Strategy): Protocol content is generated through Skill

---

## ADR-002: Data Acquisition Strategy

### Status
✅ **Decided** (2026-01-04)

### Context
Vibe Review needs to acquire two types of data:
1. **Engineering Data**: Objective data like Git diff, file paths, timestamps
2. **Protocol Data**: Structured explanation content generated by Agent

A single solution cannot satisfy acquisition requirements for both types of data.

### Decision Content
Adopt **Hook + Skill Dual-Track System**:
- **Hook Track**: Passively collect execution chain data through AGENTS framework API
- **Skill Track**: As open protocol standard, let Agents actively generate protocol content
- **Intelligent Fusion**: Automatically handle data conflicts, engineering metrics follow Hook as standard

### Alternatives
1. **Pure Hook Solution**: Only acquire data through Hook, infer protocol content from execution process
2. **Pure Skill Solution**: Only acquire data through Skill, including engineering data
3. **Log Parsing Solution**: Parse Agent output logs to acquire data

### Decision Rationale
1. **Data Accuracy**: Hook-acquired engineering data is more accurate and reliable
2. **Protocol Quality**: Skill-generated protocol content is more structured and complete
3. **Extensibility**: Dual-track system supports differentiated adaptation for different Agents
4. **Fault Tolerance**: When one track fails, the other track can still provide basic functionality

### Impact
- **Positive Impact**:
  - More comprehensive and accurate data acquisition
  - Support for multiple Agent platforms
  - Stronger system fault tolerance
- **Negative Impact**:
  - Increased system complexity
  - Need to handle data conflicts
  - Higher development and maintenance costs

### Related Decisions
- Related to ADR-003 (Skill and Rule Collaboration): Skill is an important component of dual-track system

---

## ADR-003: Skill and Rule Collaboration Approach

### Status
✅ **Decided** (2026-01-04)

### Context
In the Hook + Skill dual-track system, need to define Skill trigger methods, storage locations, granularity design, and version management strategies.

### Decision Content
- **Rule Location**: Declared in AGENTS.md + independent file defining details
- **Trigger Method**: Agent autonomous invocation (not forced trigger)
- **Skill Granularity**: Core Skills (required) + Optional Skills
- **Version Management**: Rule and Skill synchronous upgrade

### Alternatives
1. **Centralized Management**: All Rules and Skills defined in AGENTS.md
2. **Forced Trigger**: System forces Agent to call Skill
3. **Single Skill**: Only one large, comprehensive Skill
4. **Independent Versioning**: Rule and Skill independent version management

### Decision Rationale
1. **Separation of Concerns**: AGENTS.md responsible for declaration, independent files responsible for implementation details
2. **Agent Autonomy**: Maintains Agent's autonomous decision-making capability, improving adaptability
3. **Progressive Adoption**: Core + Optional design supports progressive feature adoption
4. **Consistency Assurance**: Synchronous version management ensures Rule and Skill consistency

### Impact
- **Positive Impact**:
  - Clear responsibility separation
  - Better Agent compatibility
  - Support for progressive feature extension
- **Negative Impact**:
  - Need to maintain multiple files
  - Complexity of version synchronization

### Related Decisions
- Related to ADR-002 (Data Acquisition Strategy): Skill is implementation method of dual-track system
- Related to ADR-004 (MVP Strategy): Affects MVP implementation priority

---

## ADR-004: MVP Strategy

### Status
✅ **Decided** (2026-01-04)

### Context
Vibe Review adopts 4-layer architecture (Tool Layer/Data Layer/Product Core Layer/Product Delivery Layer), need to determine MVP implementation strategy and priorities.

### Decision Content
Adopt **Phased Strategy**:
- **Phase 0**: Tool Layer (2-3 weeks) - Data collection and fusion capabilities
- **Phase 1**: Data Layer Validation (2-3 weeks) - CLI tool validates data value
- **Phase 2**: Product Core Layer (4-6 weeks) - Protocol parsing and rendering
- **Phase 3**: Product Delivery Layer (Future) - IDE plugin and integration

### Alternatives
1. **Direct Product Development**: Skip Tool Layer, directly develop product features
2. **Full Stack Parallel**: Develop all four layers simultaneously
3. **Minimum Viable**: Only do basic functionality validation

### Decision Rationale
1. **Risk Control**: Validate data model effectiveness first, avoid building product on wrong foundation
2. **Quick Feedback**: CLI tool can quickly validate core assumptions
3. **Progressive Development**: Each phase has clear validation goals
4. **Resource Optimization**: Avoid investing too many resources in uncertain features

### Impact
- **Positive Impact**:
  - Reduce project risk
  - Quickly get user feedback
  - Progressively validate core assumptions
- **Negative Impact**:
  - Extended product feature delivery time
  - Need additional CLI tool development

### Related Decisions
- Related to all other ADRs: Affects overall implementation strategy and priorities

---

## Decision Change History

### ADR-001 Change Record
- **Initial Version**: 3-layer structure (WHAT/WHY/HOW TO VERIFY)
- **Change Reason**: IMPACT is important enough to deserve separate attention
- **Final Version**: 4-layer structure (+ IMPACT as independent layer)

### ADR-002 Change Record
- **Initial Consideration**: Real-time acquisition vs post-execution analysis
- **Change Reason**: Single solution cannot satisfy all requirements
- **Final Version**: Hook + Skill Dual-Track System

### ADR-003 Change Record
- **Initial Consideration**: Centralized management vs distributed management
- **Change Reason**: Need to balance simplicity and flexibility
- **Final Version**: AGENTS.md + Independent Files

### ADR-004 Change Record
- **Initial Consideration**: Direct product feature development
- **Change Reason**: Need to validate data model effectiveness first
- **Final Version**: Phased Strategy

---

## Pending Decisions

### Open Source Strategy (ADR-005)
**Status**: ❓ **To Be Confirmed**

**Question**: Should the Product Delivery Layer be open source?

**Proposed Approach**:
- Open Source: Protocol specification, Tool Layer, Product Core Layer
- To Be Confirmed: Product Delivery Layer (VS Code plugin, GitLens integration, etc.)

**Impact**: Affects business model and community ecosystem development

---

## Decision Principles

In making the above decisions, we follow these principles:

1. **User Value First**: All decisions focus on improving user experience
2. **Technical Feasibility**: Ensure decisions are technically achievable
3. **Open Standards**: Prioritize open protocols and standards
4. **Progressive Development**: Support progressive feature extension
5. **Controllable Risk**: Control technical and product risks

---

*This document records key architectural decisions of the project, providing decision basis for subsequent development.*
