# Discussion: Code Review Refactoring for Vibe Coding Era

> Status: Confirmed | Round: R10 | Date: 2026-01-27

## ğŸ”µ Current Focus

(All major decisions confirmed for R10 ğŸ‰)

## âšª To Discuss

- [ ] Session file paths and formats for each AI IDE (needs research)

## ğŸ¸ï¸ Deferred

- [ ] Q3: How to establish and measure "trust" in the new paradigm? (#R8)
  - Options: Explanation completeness / Verification pass rate / Historical performance
  - Deferral reason: MVP phase focuses on "understanding", trust measurement needs data accumulation
  - Reserved: Confidence field in protocol

## âœ… Confirmed

| Decision | Round | Details |
|----------|--------|----------|
| ğŸ“Œ Core Problem | R0 | Using "industrial-era human review rituals" to review "post-industrial era machine-synthesized code" |
| ğŸ¯ 6-Dimensional Structural Problems | R0 | Object changed, scale imbalance, trust failure, focus shift, cognitive burden transformation, unclear boundaries |
| ğŸ’¡ Core Insight | R0 | Essence of Review is not "checking code", but "establishing understanding and trust in code" |
| ğŸ“‹ Agent Review Protocol v0.3 | R3 | â†’ [D01-agent-review-protocol](./decisions/D01-agent-review-protocol.md) |
| ğŸ—ï¸ Open Source Project Positioning | R4 | Combination of product features + tools + standard specifications |
| ğŸ“ Product Architecture | R4 | 4-layer architecture: Tool Layer / Data Layer / Product Core Layer / Product Delivery Layer |
| ğŸ·ï¸ Project Naming | R5 | Vibe Review |
| ğŸ”Œ Data Acquisition Strategy | R5 | â†’ [D02-data-acquisition-strategy](./decisions/D02-data-acquisition-strategy.md) |
| ğŸ”— Skill and Rule Collaboration | R6 | â†’ [D03-skill-rule-collaboration](./decisions/D03-skill-rule-collaboration.md) |
| ğŸš€ MVP Strategy | R7 | â†’ [D04-mvp-strategy](./decisions/D04-mvp-strategy.md) |
| ğŸ”„ Product Interaction Flow | R10 | â†’ [D05-product-interaction-flow](./decisions/D05-product-interaction-flow.md) |

### R10 Decisions Summary

| Decision | Details |
|----------|---------|
| ğŸ” Detection Strategy | Hybrid detection: Directory check + `which` command |
| ğŸ”— Connection Status | Check if our Hook config exists in platform config file |
| ğŸ“¦ Undetected Handling | Create directory if not exists, then write config |
| ğŸ”§ Supported Agents | Cursor / Cursor CLI / Claude Code / OpenCode / Gemini CLI |
| ğŸ“¦ Data Collection | Dual-track: Hook capture + Session file monitoring |
| ğŸ¯ Blame Matching | Hunk-level Levenshtein (90%/70% thresholds) |
| ğŸ“Š Blame Display | Contributor type + Source Agent + Session info + TODOs |
| ğŸ”— Terminology | Use "Connect" instead of "Install" (connect to AI Agent) |

## âŒ Rejected

(None)

## ğŸ“ Archive

### Data Model (#R7)

```
SessionSource (Session Source)
â”œâ”€ agent: Which Agent (cursor/claude/duet)
â”œâ”€ sessionId: Session ID
â”œâ”€ qaIndex: Which round of QA conversation
â””â”€ timestamp: Timestamp

ReviewUnit (Review Unit)
â”œâ”€ May contain multiple Hunks (multiple code segments represent one logical change)
â”œâ”€ Associate with SessionSource (source tracing)
â”œâ”€ Contains annotations (intent/rationale/risks/tests/edgeCases)
â””â”€ Associate with TODOs

Todo (Pending Items)
â”œâ”€ Persisted separately
â”œâ”€ Associate with SessionSource (source tracing)
â”œâ”€ Associate with ReviewUnits (bidirectional index)
â””â”€ Support clicking to navigate to conversation
```

### Product Architecture (#R4)

```
Layer 4: Product Delivery Layer
â”œâ”€ GitLens Integration: Display protocol content next to CodeDiff
â”œâ”€ Standalone Panel: Dedicated Review panel
â”œâ”€ IDE Plugin: VS Code / JetBrains / Cursor
â””â”€ Terminal Tool: CLI version

Layer 3: Product Core Layer
â”œâ”€ Protocol Parser: Parse protocol content generated by Agent
â”œâ”€ Rendering Engine: Render protocol content into visual components
â”œâ”€ Interaction Logic: Review workflow, approve/reject/comment
â””â”€ State Management: Review progress, history records

Layer 2: Data Layer âœ… Confirmed
â”œâ”€ SessionSource: Session source tracing
â”œâ”€ ReviewUnit: Multi-Hunk combination + annotations + TODO association
â”œâ”€ Todo: Separate storage, bidirectional index
â””â”€ Storage: .vibe-review/data/

Layer 1: Tool Layer âœ… Confirmed
â”œâ”€ Agent Hook: AGENTS framework API + adapter layer
â”‚   â”œâ”€ Hook Core: Unified interface
â”‚   â””â”€ Adapters: Cursor / Claude / Duet
â”œâ”€ Skill: Core Skill + optional Skills
â”‚   â”œâ”€ vibe-review-core (required)
â”‚   â”œâ”€ vibe-review-impact (optional)
â”‚   â””â”€ vibe-review-alternatives (optional)
â”œâ”€ Rule: AGENTS.md declaration + independent file definition
â”œâ”€ Git Integration: simple-git to get structured diff
â””â”€ Post-processing: Data fusion, conflict detection, protocol generation
```

### Decision Change History

| Round | Decision | Change |
|--------|----------|---------|
| R3 | Agent Review Protocol | 3 layers â†’ 4 layers (+ IMPACT as separate layer) |
| R4 | Open Source Project Positioning | Three choices â†’ combination (product+tools+specifications) |
| R5 | Project Naming | Confirmed as Vibe Review |
| R5 | Data Acquisition Strategy | Two choices â†’ Hook+Skill Dual-Track |
| R6 | Skill and Rule Collaboration | Confirmed collaboration approach |
| R7 | MVP Strategy | Direct product â†’ phased validation |
| R10 | Product Interaction Flow | Confirmed complete VS Code plugin flow |

### Discussion History

| Round | Summary |
|--------|----------|
| R0 | User shared discussion results with other AI, confirmed core problem and 6-dimensional structural problems |
| R1 | AI responded to 4 follow-up questions, proposed 3-layer protocol structure, MVP entry point, system semantic layer checklist |
| R2 | Started in-depth discussion of protocol design |
| R3 | Confirmed Agent Review Protocol v0.3 (IMPACT as separate layer, Alternatives optional, META reserved) |
| R4 | Discussed open source project positioning and product architecture (4-layer architecture design, 4 product forms) |
| R5 | Confirmed project naming Vibe Review + data acquisition strategy Hook+Skill Dual-Track |
| R6 | Confirmed Skill and Rule collaboration approach (Rule location, trigger method, Skill granularity, version management) |
| R7 | Confirmed MVP strategy (phased, data model, multi-Hunk combination, TODO bidirectional index) |
| R8 | Deferred Q3 (trust measurement), added Q8 (open source strategy) |
| R10 | Confirmed product interaction flow: detection, connection, data collection, Blame display |

---

## ğŸ“„ Discussion Artifacts

```
.codeflicker/discuss/2026-01-04/vibe-review/
â”œâ”€â”€ outline.md                              â† This file (discussion outline)
â”œâ”€â”€ meta.yaml                               â† Metadata and decision tracking
â”œâ”€â”€ decisions/
â”‚   â”œâ”€â”€ D01-agent-review-protocol.md        â† Protocol detailed documentation
â”‚   â”œâ”€â”€ D02-data-acquisition-strategy.md    â† Data acquisition strategy
â”‚   â”œâ”€â”€ D03-skill-rule-collaboration.md     â† Skill and Rule collaboration
â”‚   â”œâ”€â”€ D04-mvp-strategy.md                 â† MVP strategy
â”‚   â””â”€â”€ D05-product-interaction-flow.md     â† Product interaction flow (R10)
â””â”€â”€ notes/
    â””â”€â”€ README.md                           â† Technical solution overview
```
