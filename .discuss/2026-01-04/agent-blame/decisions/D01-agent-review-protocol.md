# Agent Review Protocol v0.3

**Decision Date**: #R3  
**Status**: ✅ Confirmed  
**Related Outline**: [Back to Outline](../outline.md)

---

**Date**: 2026-01-04


---

## Background

In the Vibe Coding era, code generated by Agents lacks "author intent" transmission, causing Review to become "reverse engineering." We need a protocol that allows Agents to provide structured explanations when generating code, transforming Review from "reverse engineering" to "verification and alignment."

**Core Insight**: The essence of Review is not "checking code," but "establishing understanding and trust in code."

---

## Protocol Structure

```
┌─────────────────────────────────────────────────────┐
│  Agent Review Protocol v0.3                           │
├─────────────────────────────────────────────────────┤
│                                                     │
│  Layer 1: WHAT (What was done)            [Required]   │
│  ├─ Intent: I understand you want to do X      [Required]   │
│  └─ Changes: I changed A, B, C                   [Required]   │
│                                                     │
│  Layer 2: WHY (Why do this)               [Required]   │
│  └─ Rationale: I chose solution X because...  [Required]   │
│                                                     │
│  Layer 3: HOW TO VERIFY (How to verify)     [Required]   │
│  ├─ Tests: You can verify through these tests      [Required]   │
│  └─ Edge Cases: These edge cases need confirmation [Required]   │
│                                                     │
│  Layer 4: IMPACT (Impact scope)            [Optional]   │
│  └─ This may affect D, E (side effect analysis) [Optional]   │
│                                                     │
│  ───────────────────────────────────────────────  │
│  Optional Extensions                                  │
│  ├─ Alternatives: I didn't choose Y, Z because... [Optional]   │
│  ├─ Assumptions: I assumed...                    [Optional]   │
│  ├─ Confidence: I'm confident about A, uncertain about B [Optional]   │
│  └─ META: Scope/Risk/Review Hint                  [Optional]   │
│                                                     │
└─────────────────────────────────────────────────────┘
```

---

## Required vs Optional

### Required to Provide (5 items)

| Layer | Field | Description |
|-------|-------|-------------|
| WHAT | Intent | What I understand you want to do |
| WHAT | Changes | Which files/code I changed |
| WHY | Rationale | Why I designed it this way |
| HOW TO VERIFY | Tests | How to verify I did it correctly |
| HOW TO VERIFY | Edge Cases | Edge cases that need confirmation |

### Optional to Provide (5 items)

| Layer | Field | Description | Applicable Scenarios |
|-------|-------|-------------|---------------------|
| IMPACT | Impact | Other parts that may be affected | When changes involve multiple modules |
| WHY | Alternatives | Rejected solutions | When there are multiple optional solutions |
| WHY | Assumptions | Implicit assumptions | When there are uncertain premises |
| HOW TO VERIFY | Confidence | Confidence level | When there are uncertain implementations |
| META | Scope/Risk/Hint | Metadata | When changes are large |

---

## Complete Example

### Scenario: Adding "Remember Me" feature to login page

```markdown
## Agent Blame Protocol v0.3

### WHAT (What was done) [Required]

**Intent**: 
You want to add a "Remember Me" feature to the login page to auto-fill the username when the user visits next time.

**Changes**:
- `src/pages/Login.tsx`: Add checkbox component and state management
- `src/utils/storage.ts`: Add localStorage read/write utility functions
- `src/hooks/useAuth.ts`: Modify login logic to support remembering username

### WHY (Why do this) [Required]

**Rationale**:
- Use localStorage instead of cookie because it only needs to be used on the frontend
- Store username but not password to balance convenience and security

### HOW TO VERIFY (How to verify) [Required]

**Tests**:
- Check "Remember Me" → Login → Close browser → Reopen → Username should auto-fill
- Uncheck → Login → Close → Reopen → Username should be empty

**Edge Cases**:
- localStorage may not be available in private mode
- How to handle when switching between multiple accounts?

### IMPACT (Impact scope) [Optional]

- Login process will have one additional step (reading localStorage)
- User privacy: Username will be stored locally (not password)
- Clearing cache will cause "Remember Me" to fail

---

### Optional Extensions

**Alternatives**:
- ❌ Use cookie: Requires backend cooperation, increases complexity
- ❌ Store full credentials: Too high security risk

**Assumptions**:
- Assume username is not sensitive information
- Assume browser supports localStorage (modern browsers all support)

**Confidence**:
- ✅ High confidence: Checkbox UI and state management
- ⚠️ Medium confidence: Timing of localStorage read/write
- ❓ Need confirmation: Whether to encrypt stored username

**META**:
- Scope: Small change (3 files, about 50 lines of code)
- Risk: Low (does not affect core login logic)
- Review Hint: Recommend focusing on login flow modifications in `useAuth.ts`
```

---

## Design Decision Record

### Why is IMPACT a separate layer?

**Decision**: IMPACT as independent 4th layer, not placed in WHAT layer

**Reasons**:
1. IMPACT is important enough to deserve separate attention
2. WHAT layer answers "what was done", IMPACT answers "what will be affected" - these are two different questions
3. As an optional layer, can decide whether to provide it based on change scale

### Why is Alternatives optional?

**Decision**: Alternatives as optional field

**Reasons**:
1. Not all changes have multiple optional solutions
2. Simple changes don't need to explain "why not other solutions"
3. But when there are multiple optional solutions, this information is very valuable for review

### Why keep META layer?

**Decision**: META as optional extension reserved

**Reasons**:
1. Helps reviewer quickly judge "how much effort to spend on review"
2. Provides guidance on "where to start reviewing"
3. Particularly useful for large changes

---

## Format Specification

### Recommended Format: Markdown

**Reasons**:
- Good human readability
- Can be embedded in PR descriptions, commit messages
- Can be parsed by tools

### Future Consideration: Structured Format

If automatic tool parsing is needed, consider:
- YAML frontmatter + Markdown body
- JSON Schema definition

---

## Association with Other Decisions

| Related Decision | Association Explanation |
|-----------------|----------------------|
| [Data Acquisition Strategy](./D02-data-acquisition-strategy.md) | Protocol content generated through Skill |
| [Skill and Rule Collaboration](./D03-skill-rule-collaboration.md) | agent-blame-core Skill responsible for generating protocol |
| [MVP Strategy](./D04-mvp-strategy.md) | Protocol content as annotation of ReviewUnit |

---

## Next Steps

1. Implement agent-blame-core Skill (generate protocol content)
2. Display protocol content in terminal tools
3. Iterate protocol based on practice feedback

---


---

**Last Updated**: 2026-01-04
